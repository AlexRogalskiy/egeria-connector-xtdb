<!doctype html>
<!-- SPDX-License-Identifier: CC-BY-4.0 -->
<!-- Copyright Contributors to the ODPi Egeria project. -->
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Crux Repository Connector for Egeria - Migrating</title>

    <meta name="description" content="Migrating an Egeria Crux repository for the latest version fo the connector">
    <meta name="author" content="Christopher Grote">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="stylesheet" href="../reveal.js/dist/reset.css">
    <link rel="stylesheet" href="../reveal.js/dist/reveal.css">
    <link rel="stylesheet" href="../reveal.js/dist/theme/black.css" id="theme">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="../reveal.js/plugin/highlight/monokai.css" id="highlight-theme">
</head>
<body>
<div class="reveal">
    <div class="slides">

        <section class="center" data-menu-title="Migrating">
            <h1>Crux</h1>
            <h4>Repository Connector for Egeria</h4>
            <h2>Migrating</h2>
        </section>
        <section>
            <section>
                <h2 style="text-align: left;">Orientation</h2>
                <h4 style="text-align: left;">TL;DR?</h4>
                <p style="font-size: x-large; text-align: left;">
                    Just use the <a href="#" class="navigate-right">right arrow</a> on your keyboard: each slide is one step, with minimal explanation.
                </p><br>
                <h4 style="text-align: left;">Need more?</h4>
                <p style="font-size: x-large; text-align: left;">
                    If at any point you want more of an explanation, use the <a href="#" class="navigate-down">down arrow</a>
                    on your keyboard to drill-down.
                </p>
            </section>
            <section>
                <h3 style="text-align: left;">Keyboard shortcuts</h3>
                <p style="font-size: x-large; text-align: left;">
                    Aha, you want more!
                    <br><br>
                    This migration guide is written using a great web-based presentation framework
                    called <a href="https://revealjs.com" target="reveal">reveal.js</a>. You can use its icons
                    on the slides to move around, or you can use keyboard shortcuts. Try the <code>?</code> key
                    to bring up a cheatsheet of the keyboard shortcuts.
                </p>
                <p class="fragment fade-in-then-semi-out" style="font-size: x-large; text-align: left;">
                    At any point, you can also press the <code>m</code> key to bring up the menu. From the menu you
                    can quickly jump to any particular topic.
                </p>
                <p class="fragment fade-in-then-semi-out" style="font-size: x-large; text-align: left;">
                    Looking for more about how the migration actually works, rather than this primer on keyboard
                    shortcuts? Proceed downwards once again.
                </p>
            </section>
            <section data-menu-title="How it works" data-transition="fade">
                <h4 style="text-align: left;">How it works</h4>
                <p style="font-size: x-large; text-align: left;">
                    The connector embeds its own persistence layer (storage) for metadata in Crux. While we try
                    to keep this underlying storage unchanged as much as possible to ease moving from one version
                    of the connector to another, this is not always possible.
                </p>
                <p class="fragment fade-in-then-semi-out" style="font-size: x-large; text-align: left;">
                    It may therefore be necessary to occasionally migrate any pre-existing metadata stored in the
                    embedded Crux repository in order to make use of the latest features and performance benefits of
                    a new version of the connector. In fact, to ensure the integrity of the metadata, the connector
                    will validate that the version of the persistence matches what the version of the connector expects
                    before even attempting to run -- if this validation fails, you will see a <code>OMRS-CRUX-REPOSITORY-500-003</code>
                    error in the audit log to indicate that you must first migrate the metadata before running this
                    version of the connector.
                </p>
            </section>
            <section data-transition="fade">
                <h4 style="text-align: left;">How it works</h4>
                <p style="font-size: x-large; text-align: left;">
                    The migration itself runs outside the connector (while the connector is offline), in order to
                    maximize the throughput of the in-place upgrade of the repository. The time it takes to run the
                    migration naturally depends on a number of factors, such as the amount of pre-existing metadata
                    that must be migrated and the specific changes needed by the upgrade.
                </p>
                <p class="fragment fade-in-then-semi-out" style="font-size: x-large; text-align: left;">
                    As a very approximate metric, we would expect the in-place upgrade to be capable of migrating
                    60-100 metadata instances (entities or relationships) per second.  So 10 000 instances should
                    take approximately 2 minutes.
                </p>
                <p class="fragment fade-in-then-semi-out" style="font-size: x-large; text-align: left;">
                    If migration is needed, the newer version of the connector will not allow you to run against an
                    older set of metadata without first running the migration. Your only options will be to continue
                    to use an older version of the connector (with which your pre-existing metadata is compatible),
                    or to run this offline migration of your repository and then run the newer version of the connector.
                </p>
            </section>
        </section>
        <section>
            <section>
                <h2 style="text-align: left;">1. Obtain migrator</h2>
                <p style="font-size: x-large; text-align: left;">
                    Start by downloading the Crux repository migrator:
                </p>
                <div align="center">
                    <a href="http://repository.sonatype.org/service/local/artifact/maven/redirect?r=central-proxy&g=org.odpi.egeria&a=egeria-connector-crux-migrator&v=RELEASE&c=jar-with-dependencies">
                        <img alt="Release" src="https://img.shields.io/maven-central/v/org.odpi.egeria/egeria-connector-crux-migrator?label=release">
                    </a>
                    <a href="https://oss.sonatype.org/content/repositories/snapshots/org/odpi/egeria/egeria-connector-crux-migrator/" target="dev">
                        <img alt="Development" src="https://img.shields.io/nexus/s/org.odpi.egeria/egeria-connector-crux-migrator?label=development&server=https%3A%2F%2Foss.sonatype.org">
                    </a>
                </div>
                <p style="font-size: x-large; text-align: left;">
                    The single file downloaded is the migrator:<br>
                    <code>egeria-connector-crux-migrator-{version}-jar-with-dependencies.jar</code>
                </p>
            </section>
            <section>
                <h3 style="text-align: left;">Snapshots</h3>
                <p style="font-size: x-large; text-align: left;">
                    Our development snapshots are hosted directly within Nexus's open source snapshot repository.
                    You can download them there using Maven itself, or by
                    <a href="https://oss.sonatype.org/content/repositories/snapshots/org/odpi/egeria/egeria-connector-crux-migrator/" target="dev">navigating to the site</a>
                    and looking for the latest version of the <code>jar-with-dependencies.jar</code> file.
                </p>
                <p class="fragment" style="font-size: x-large; text-align: left;">
                    Alternatively, you may want to build it yourself...
                </p>
            </section>
            <section data-auto-animate data-menu-title="Building">
                <h4 style="text-align: left;">Building</h4>
                <pre data-id="code-animation" class="shell session" style="font-size: small;"><code class="hljs" data-trim data-line-numbers="1,9-10">
$ git clone https://github.com/odpi/egeria-connector-crux.git
Cloning into 'egeria-connector-crux'...
remote: Enumerating objects: 531, done.
remote: Counting objects: 100% (531/531), done.
remote: Compressing objects: 100% (193/193), done.
remote: Total 531 (delta 168), reused 446 (delta 101), pack-reused 0
Receiving objects: 100% (531/531), 162.39 KiB | 1.01 MiB/s, done.
Resolving deltas: 100% (168/168), done.
$ cd egeria-connector-crux
$ mvn clean install
[INFO] Scanning for projects...
[INFO]
[INFO] ---------------< org.odpi.egeria:egeria-connector-crux >----------------
[INFO] Building Egeria Connector for Crux 2.8-SNAPSHOT
[INFO] --------------------------------[ jar ]---------------------------------
[INFO]
[INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ egeria-connector-crux ---
[INFO] Deleting .../egeria-connector-crux/target
[INFO]
[INFO] --- maven-enforcer-plugin:3.0.0-M3:enforce (enforce-versions) @ egeria-connector-crux ---
[INFO]
[INFO] --- apache-rat-plugin:0.13:check (rat-check) @ egeria-connector-crux ---
[INFO] Added 3 additional default licenses.
[INFO] Enabled default license matchers.
[INFO] Added 2 custom approved licenses.
[INFO] Will parse SCM ignores for exclusions...
[INFO] Parsing exclusions from .../egeria-connector-crux/.gitignore
[INFO] Finished adding exclusions from SCM ignore files.
[INFO] 102 implicit excludes (use -debug for more details).
[INFO] 28 explicit excludes (use -debug for more details).
[INFO] 38 resources included (use -debug for more details)
[INFO] Rat check: Summary over all files. Unapproved: 0, unknown: 0, generated: 0, approved: 36 licenses.
[INFO]
[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ egeria-connector-crux ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 2 resources
[INFO]
[INFO] --- maven-compiler-plugin:3.8.1:compile (default-compile) @ egeria-connector-crux ---
[INFO] Changes detected - recompiling the module!
[INFO] Compiling 20 source files to .../egeria-connector-crux/target/classes
[INFO]
[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ egeria-connector-crux ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] skip non existing resourceDirectory .../egeria-connector-crux/src/test/resources
[INFO]
[INFO] --- jacoco-maven-plugin:0.8.6:prepare-agent (agent) @ egeria-connector-crux ---
[INFO] argLine set to -javaagent:.../.m2/repository/org/jacoco/org.jacoco.agent/0.8.6/org.jacoco.agent-0.8.6-runtime.jar=destfile=.../egeria-connector-crux/target/jacoco.exec
[INFO]
[INFO] --- maven-compiler-plugin:3.8.1:testCompile (default-testCompile) @ egeria-connector-crux ---
[INFO] Changes detected - recompiling the module!
[INFO]
[INFO] --- maven-surefire-plugin:3.0.0-M5:test (default-test) @ egeria-connector-crux ---
[INFO]
[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ egeria-connector-crux ---
[INFO] Building jar: .../egeria-connector-crux/target/egeria-connector-crux-2.8-SNAPSHOT.jar
[INFO]
[INFO] --- maven-assembly-plugin:3.3.0:single (default) @ egeria-connector-crux ---
[INFO] Building jar: .../egeria-connector-crux/target/egeria-connector-crux-2.8-SNAPSHOT-jar-with-dependencies.jar
[INFO]
[INFO] --- maven-source-plugin:3.2.1:jar-no-fork (attach-sources) @ egeria-connector-crux ---
[INFO] Building jar: .../egeria-connector-crux/target/egeria-connector-crux-2.8-SNAPSHOT-sources.jar
[INFO]
[INFO] --- maven-javadoc-plugin:3.2.0:jar (attach-javadocs) @ egeria-connector-crux ---
[INFO] No previous run data found, generating javadoc.
[INFO] Building jar: .../egeria-connector-crux/target/egeria-connector-crux-2.8-SNAPSHOT-javadoc.jar
[INFO]
[INFO] --- jacoco-maven-plugin:0.8.6:report (report) @ egeria-connector-crux ---
[INFO] Skipping JaCoCo execution due to missing execution data file.
[INFO]
[INFO] --- maven-dependency-plugin:3.1.2:analyze-only (analyze) @ egeria-connector-crux ---
[INFO] No dependency problems found
[INFO]
[INFO] --- maven-install-plugin:2.4:install (default-install) @ egeria-connector-crux ---
[INFO] Installing .../egeria-connector-crux/target/egeria-connector-crux-2.8-SNAPSHOT.jar to .../.m2/repository/org/odpi/egeria/egeria-connector-crux/2.8-SNAPSHOT/egeria-connector-crux-2.8-SNAPSHOT.jar
[INFO] Installing .../egeria-connector-crux/pom.xml to .../.m2/repository/org/odpi/egeria/egeria-connector-crux/2.8-SNAPSHOT/egeria-connector-crux-2.8-SNAPSHOT.pom
[INFO] Installing .../egeria-connector-crux/target/egeria-connector-crux-2.8-SNAPSHOT-jar-with-dependencies.jar to .../.m2/repository/org/odpi/egeria/egeria-connector-crux/2.8-SNAPSHOT/egeria-connector-crux-2.8-SNAPSHOT-jar-with-dependencies.jar
[INFO] Installing .../egeria-connector-crux/target/egeria-connector-crux-2.8-SNAPSHOT-sources.jar to .../.m2/repository/org/odpi/egeria/egeria-connector-crux/2.8-SNAPSHOT/egeria-connector-crux-2.8-SNAPSHOT-sources.jar
[INFO] Installing .../egeria-connector-crux/target/egeria-connector-crux-2.8-SNAPSHOT-javadoc.jar to .../.m2/repository/org/odpi/egeria/egeria-connector-crux/2.8-SNAPSHOT/egeria-connector-crux-2.8-SNAPSHOT-javadoc.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  10.059 s
[INFO] Finished at: 2021-02-12T16:27:32Z
[INFO] ------------------------------------------------------------------------
						</code></pre>
                <p style="font-size: x-large; text-align: left;">
                    To build the migrator, begin by cloning this repository to your build machine and then run
                    the Maven build command highlighted above. You will need to have at least Java version 1.8
                    installed as well as Apache Maven (at least version 3.6).
                </p>
            </section>
            <section data-auto-animate>
                <h4 style="text-align: left;">Building</h4>
                <pre data-id="code-animation" class="shell session" style="font-size: small;"><code class="hljs" data-trim data-line-numbers="68">
$ cd egeria-connector-crux
$ mvn clean install
[INFO] Scanning for projects...
[INFO]
[INFO] ---------------< org.odpi.egeria:egeria-connector-crux >----------------
[INFO] Building Egeria Connector for Crux 2.8-SNAPSHOT
[INFO] --------------------------------[ jar ]---------------------------------
[INFO]
[INFO] --- maven-clean-plugin:2.5:clean (default-clean) @ egeria-connector-crux ---
[INFO] Deleting .../egeria-connector-crux/target
[INFO]
[INFO] --- maven-enforcer-plugin:3.0.0-M3:enforce (enforce-versions) @ egeria-connector-crux ---
[INFO]
[INFO] --- apache-rat-plugin:0.13:check (rat-check) @ egeria-connector-crux ---
[INFO] Added 3 additional default licenses.
[INFO] Enabled default license matchers.
[INFO] Added 2 custom approved licenses.
[INFO] Will parse SCM ignores for exclusions...
[INFO] Parsing exclusions from .../egeria-connector-crux/.gitignore
[INFO] Finished adding exclusions from SCM ignore files.
[INFO] 102 implicit excludes (use -debug for more details).
[INFO] 28 explicit excludes (use -debug for more details).
[INFO] 38 resources included (use -debug for more details)
[INFO] Rat check: Summary over all files. Unapproved: 0, unknown: 0, generated: 0, approved: 36 licenses.
[INFO]
[INFO] --- maven-resources-plugin:2.6:resources (default-resources) @ egeria-connector-crux ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] Copying 2 resources
[INFO]
[INFO] --- maven-compiler-plugin:3.8.1:compile (default-compile) @ egeria-connector-crux ---
[INFO] Changes detected - recompiling the module!
[INFO] Compiling 20 source files to .../egeria-connector-crux/target/classes
[INFO]
[INFO] --- maven-resources-plugin:2.6:testResources (default-testResources) @ egeria-connector-crux ---
[INFO] Using 'UTF-8' encoding to copy filtered resources.
[INFO] skip non existing resourceDirectory .../egeria-connector-crux/src/test/resources
[INFO]
[INFO] --- jacoco-maven-plugin:0.8.6:prepare-agent (agent) @ egeria-connector-crux ---
[INFO] argLine set to -javaagent:.../.m2/repository/org/jacoco/org.jacoco.agent/0.8.6/org.jacoco.agent-0.8.6-runtime.jar=destfile=.../egeria-connector-crux/target/jacoco.exec
[INFO]
[INFO] --- maven-compiler-plugin:3.8.1:testCompile (default-testCompile) @ egeria-connector-crux ---
[INFO] Changes detected - recompiling the module!
[INFO]
[INFO] --- maven-surefire-plugin:3.0.0-M5:test (default-test) @ egeria-connector-crux ---
[INFO]
[INFO] --- maven-jar-plugin:2.4:jar (default-jar) @ egeria-connector-crux ---
[INFO] Building jar: .../egeria-connector-crux/target/egeria-connector-crux-2.8-SNAPSHOT.jar
[INFO]
[INFO] --- maven-assembly-plugin:3.3.0:single (default) @ egeria-connector-crux ---
[INFO] Building jar: .../egeria-connector-crux/target/egeria-connector-crux-2.8-SNAPSHOT-jar-with-dependencies.jar
[INFO]
[INFO] --- maven-source-plugin:3.2.1:jar-no-fork (attach-sources) @ egeria-connector-crux ---
[INFO] Building jar: .../egeria-connector-crux/target/egeria-connector-crux-2.8-SNAPSHOT-sources.jar
[INFO]
[INFO] --- maven-javadoc-plugin:3.2.0:jar (attach-javadocs) @ egeria-connector-crux ---
[INFO] No previous run data found, generating javadoc.
[INFO] Building jar: .../egeria-connector-crux/target/egeria-connector-crux-2.8-SNAPSHOT-javadoc.jar
[INFO]
[INFO] --- jacoco-maven-plugin:0.8.6:report (report) @ egeria-connector-crux ---
[INFO] Skipping JaCoCo execution due to missing execution data file.
[INFO]
[INFO] --- maven-dependency-plugin:3.1.2:analyze-only (analyze) @ egeria-connector-crux ---
[INFO] No dependency problems found
[INFO]
[INFO] --- maven-install-plugin:2.4:install (default-install) @ egeria-connector-crux ---
[INFO] Installing .../egeria-connector-crux/target/egeria-connector-crux-2.8-SNAPSHOT.jar to .../.m2/repository/org/odpi/egeria/egeria-connector-crux/2.8-SNAPSHOT/egeria-connector-crux-2.8-SNAPSHOT.jar
[INFO] Installing .../egeria-connector-crux/pom.xml to .../.m2/repository/org/odpi/egeria/egeria-connector-crux/2.8-SNAPSHOT/egeria-connector-crux-2.8-SNAPSHOT.pom
[INFO] Installing .../egeria-connector-crux/target/egeria-connector-crux-2.8-SNAPSHOT-jar-with-dependencies.jar to .../.m2/repository/org/odpi/egeria/egeria-connector-crux/2.8-SNAPSHOT/egeria-connector-crux-2.8-SNAPSHOT-jar-with-dependencies.jar
[INFO] Installing .../egeria-connector-crux/target/egeria-connector-crux-2.8-SNAPSHOT-sources.jar to .../.m2/repository/org/odpi/egeria/egeria-connector-crux/2.8-SNAPSHOT/egeria-connector-crux-2.8-SNAPSHOT-sources.jar
[INFO] Installing .../egeria-connector-crux/target/egeria-connector-crux-2.8-SNAPSHOT-javadoc.jar to .../.m2/repository/org/odpi/egeria/egeria-connector-crux/2.8-SNAPSHOT/egeria-connector-crux-2.8-SNAPSHOT-javadoc.jar
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  10.059 s
[INFO] Finished at: 2021-02-12T16:27:32Z
[INFO] ------------------------------------------------------------------------
						</code></pre>
                <p style="font-size: x-large; text-align: left;">
                    Note from the output that the build creates the file <code>.../egeria-connector-crux/target/egeria-connector-crux-2.8-SNAPSHOT-jar-with-dependencies.jar</code>.
                    This is the migrator, which you can use just as if you had downloaded it.
                </p>
            </section>
        </section>
        <section>
            <section data-auto-animate>
                <h2 style="text-align: left;">2. Configure repository</h2>
                <p style="font-size: x-large; text-align: left;">
                    Before running the migrator, define the configuration of your repository:
                </p>
                <pre data-id="code-animation" class="json" style="font-size: small;"><code class="hljs" data-trim data-line-numbers>
{
  "crux/index-store": {
    "kv-store": {
      "crux/module": "crux.rocksdb/->kv-store",
      "db-dir": ".../data/servers/crux/rdb-index"
    }
  },
  "crux/document-store": {
    "kv-store": {
      "crux/module": "crux.rocksdb/->kv-store",
      "db-dir": ".../data/servers/crux/rdb-docs"
    }
  },
  "crux/tx-log": {
    "kv-store": {
      "crux/module": "crux.rocksdb/->kv-store",
      "db-dir": ".../data/servers/crux/rdb-tx"
    }
  },
  "egeria.crux.lucene/lucene-store": {
    "db-dir": ".../data/servers/crux/lucene"
  }
}
                </code></pre>
                <p style="font-size: x-large; text-align: left;">
                    See below for more details on writing this configuration file.
                </p>
            </section>
            <section data-auto-animate data-menu-title="Configuration file">
                <h4 style="text-align: left;">Configuration file</h4>
                <pre data-id="code-animation" class="json" style="font-size: small;"><code class="hljs" data-trim data-line-numbers="9-31">
{
    "class": "Connection",
    "connectorType": {
        "class": "ConnectorType",
        "connectorProviderClassName": "org.odpi.egeria.connectors.juxt.crux.repositoryconnector.CruxOMRSRepositoryConnectorProvider"
    },
    "configurationProperties": {
        "cruxConfig":
        {
            "crux/index-store": {
                "kv-store": {
                    "crux/module": "crux.rocksdb/->kv-store",
                    "db-dir": "data/servers/crux/rdb-index"
                }
            },
            "crux/document-store": {
                "kv-store": {
                    "crux/module": "crux.rocksdb/->kv-store",
                    "db-dir": "data/servers/crux/rdb-docs"
                }
            },
            "crux/tx-log": {
                "kv-store": {
                    "crux/module": "crux.rocksdb/->kv-store",
                    "db-dir": "data/servers/crux/rdb-tx"
                }
            },
            "egeria.crux.lucene/lucene-store": {
                "db-dir": "data/servers/crux/lucene"
            }
        }
    }
}
                </code></pre>
                <p style="font-size: x-large; text-align: left;">
                    The configuration must be defined in a JSON file, following <a href="https://opencrux.com/reference/configuration.html" target="dev">Crux's JSON configuration format</a>.
                </p>
                <p class="fragment" style="font-size: x-large; text-align: left;">
                    The simplest way to ensure this matches the configuration used by your connector is to copy the
                    <code>cruxConfig</code> property from the request you POST to Egeria to configure your connector.
                    Simply be certain to replace any relative paths with absolute paths to data to ensure the migrator
                    can find the metadata.
                </p>
            </section>
        </section>
        <section>
            <section>
                <h2 style="text-align: left;">3. Make a backup</h2>
                <p style="font-size: x-large; text-align: left;">
                    As the migration runs in-place, it is always a good practice to take a backup
                    of your repository first:
                </p>
                <pre data-id="code-animation" class="shell session" style="font-size: small;"><code class="hljs" data-trim data-line-numbers="1">
$ tar cvf backup.tar .../data/servers/crux
a .../data/servers/crux
a .../data/servers/crux/rdb-index
a .../data/servers/crux/lucene
a .../data/servers/crux/config
a .../data/servers/crux/cohorts
a .../data/servers/crux/rdb-tx
a .../data/servers/crux/rdb-docs
a .../data/servers/crux/rdb-docs/LOG.old.1618821614946783
a .../data/servers/crux/rdb-docs/MANIFEST-055963
a .../data/servers/crux/rdb-docs/055956.sst
a .../data/servers/crux/rdb-docs/IDENTITY
a .../data/servers/crux/rdb-docs/OPTIONS-055963
a .../data/servers/crux/rdb-docs/LOCK
a .../data/servers/crux/rdb-docs/LOG.old.1618823379594188
a .../data/servers/crux/rdb-docs/CURRENT
a .../data/servers/crux/rdb-docs/LOG
a .../data/servers/crux/rdb-docs/OPTIONS-055966
a .../data/servers/crux/rdb-docs/055962.sst
a .../data/servers/crux/rdb-docs/055964.log
a .../data/servers/crux/rdb-docs/055958.sst
a .../data/servers/crux/rdb-tx/IDENTITY
a .../data/servers/crux/rdb-tx/055918.log
a .../data/servers/crux/rdb-tx/055908.sst
a .../data/servers/crux/rdb-tx/LOCK
a .../data/servers/crux/rdb-tx/055916.sst
a .../data/servers/crux/rdb-tx/CURRENT
a .../data/servers/crux/rdb-tx/OPTIONS-055917
a .../data/servers/crux/rdb-tx/055910.sst
a .../data/servers/crux/rdb-tx/OPTIONS-055920
a .../data/servers/crux/rdb-tx/055912.sst
a .../data/servers/crux/rdb-tx/LOG.old.1618821615456822
a .../data/servers/crux/rdb-tx/LOG
a .../data/servers/crux/rdb-tx/MANIFEST-055917
a .../data/servers/crux/rdb-tx/LOG.old.1618823380203383
a .../data/servers/crux/cohorts/cocoCohort.registrystore
a .../data/servers/crux/config/crux.config
a .../data/servers/crux/lucene/_mx7.cfe
a .../data/servers/crux/lucene/_mx6_Lucene84_0.doc
a .../data/servers/crux/lucene/_mx6.fnm
a .../data/servers/crux/lucene/_mx6_Lucene84_0.tip
a .../data/servers/crux/lucene/_mx6.fdx
a .../data/servers/crux/lucene/_mx6_Lucene84_0.pos
a .../data/servers/crux/lucene/_mx6.fdm
a .../data/servers/crux/lucene/_mx6_Lucene84_0.tim
a .../data/servers/crux/lucene/_mx6_Lucene84_0.tmd
a .../data/servers/crux/lucene/_mx8.cfs
a .../data/servers/crux/lucene/_mx6.si
a .../data/servers/crux/lucene/_mx7.cfs
a .../data/servers/crux/lucene/_mx6_1.liv
a .../data/servers/crux/lucene/_mx6.nvd
a .../data/servers/crux/lucene/_mx6.nvm
a .../data/servers/crux/lucene/_mx7.si
a .../data/servers/crux/lucene/_mx6.fdt
a .../data/servers/crux/lucene/segments_j7d
a .../data/servers/crux/lucene/write.lock
a .../data/servers/crux/lucene/_mx8.si
a .../data/servers/crux/lucene/_mx7_2.liv
a .../data/servers/crux/lucene/_mx8.cfe
a .../data/servers/crux/rdb-index/000170.log
a .../data/servers/crux/rdb-index/MANIFEST-000169
a .../data/servers/crux/rdb-index/000173.sst
a .../data/servers/crux/rdb-index/IDENTITY
a .../data/servers/crux/rdb-index/OPTIONS-000172
a .../data/servers/crux/rdb-index/OPTIONS-000169
a .../data/servers/crux/rdb-index/LOCK
a .../data/servers/crux/rdb-index/LOG.old.1618821614837424
a .../data/servers/crux/rdb-index/LOG.old.1618823379143533
a .../data/servers/crux/rdb-index/CURRENT
a .../data/servers/crux/rdb-index/LOG
                </code></pre>
                <p style="font-size: x-large; text-align: left;">
                    ... where <code>.../data/servers/crux</code> is the location of your repository.
                </p>
            </section>
            <section data-menu-title="Backup details" data-auto-animate>
                <h4 style="text-align: left;">Backup details</h4>
                <p style="font-size: x-large; text-align: left;">
                    Different configurations will require different approaches to backup. The example given in the
                    previous slide will work when your repository is entirely file-based (for example, if it is
                    configured to use RocksDB, Lucene, and / or LMDB).
                </p>
                <p class="fragment fade-in-then-semi-out" style="font-size: x-large; text-align: left;">
                    If your configuration makes use of other pluggable components (Kafka, JDBC, etc) then you should
                    follow the best practices for backing up those components themselves: either from Apache Kafka or
                    the database vendor.
                </p>
                <p class="fragment fade-in-then-semi-out" style="font-size: x-large; text-align: left;">
                    In all cases, you should ensure that your connector is shutdown (not running), and that any data
                    is appropriately quiesced prior to running the backup.
                </p>
            </section>
        </section>
        <section>
            <section>
                <h2 style="text-align: left;">4. Run the in-place upgrade</h2>
                <p style="font-size: x-large; text-align: left;">
                    Run the following command to execute the in-place upgrade:
                </p>
                <pre data-id="code-animation" class="shell session" style="font-size: small;"><code class="hljs" data-trim data-line-numbers="1">
$ java -jar egeria-connector-crux-migrator-${version}-jar-with-dependencies.jar config.json
Starting a Crux node using configuration: config.json
SLF4J: Failed to load class "org.slf4j.impl.StaticLoggerBinder".
SLF4J: Defaulting to no-operation (NOP) logger implementation
SLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.
... checking if migration is needed (crux.api.java.JCruxNode@25c4bb06)
The node is at version -1, while latest is 2 -- migrating...
                </code></pre>
                <p style="font-size: x-large; text-align: left;">
                    ... where <code>config.json</code> is the file containing your repository's configuration.
                </p>
            </section>
            <section data-menu-title="Possible outputs" data-auto-animate>
                <h4 style="text-align: left;">Possible outputs</h4>
                <p style="font-size: x-large; text-align: left;">
                    If you run the migrator and no migration is actually needed, you will see output similar to the
                    following:
                </p>
                <pre data-id="code-animation" class="text" style="font-size: small;"><code class="hljs" data-trim data-line-numbers>
Starting a Crux node using configuration: config.json
SLF4J: Failed to load class "org.slf4j.impl.StaticLoggerBinder".
SLF4J: Defaulting to no-operation (NOP) logger implementation
SLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.
... checking if migration is needed (crux.api.java.JCruxNode@25c4bb06)
This node is already at the latest version of the persistence layer -- no migration needed.
                </code></pre>
                <p class="fragment fade-in-then-semi-out" style="font-size: x-large; text-align: left;">
                    This indicates that your repository is already at the necessary version to work with this version of
                    the connector, and no migration is needed. You can simply proceed with running the connector.
                </p>
            </section>
            <section data-auto-animate>
                <h4 style="text-align: left;">Possible outputs</h4>
                <p style="font-size: x-large; text-align: left;">
                    If a migration is necessary, it will immediately begin to run and you will see output similar to
                    the following:
                </p>
                <pre data-id="code-animation" class="text" style="font-size: small;"><code class="hljs" data-trim data-line-numbers>
Starting a Crux node using configuration: config.json
SLF4J: Failed to load class "org.slf4j.impl.StaticLoggerBinder".
SLF4J: Defaulting to no-operation (NOP) logger implementation
SLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.
... checking if migration is needed (crux.api.java.JCruxNode@25c4bb06)
The node is at version -1, while latest is 2 -- migrating...
                </code></pre>
                <p class="fragment fade-in-then-semi-out" style="font-size: x-large; text-align: left;">
                    This indicates the existing version of the persistence layer, and the version that is expected by
                    this version of the connector. If you are making a jump across several migrations, you may see this
                    last line appear multiple times with different existing versions listed each time: the in-place
                    upgrade sequentially applies the necessary migrations step-by-step.
                </p>
            </section>
        </section>
        <section>
            <section>
                <h2 style="text-align: left;">5. Start the connector</h2>
                <p style="font-size: x-large; text-align: left;">
                    Once the previous (in-place upgrade) command completes, you should now be able to start your
                    connector. See the <a href="../getting-started/">Getting Started guide</a> for more details.
                </p>
            </section>
            <section>
                <h3 style="text-align: left;">Change Log</h3>
                <p style="font-size: x-large; text-align: left;">
                    There should be no need to actually understand these details, as the connector (and migration)
                    will handle them for you. However, for the interested reader, the following changes were made to
                    the storage layer:
                </p>
                <ul style="font-size: x-large; text-align: left;">
                    <li>2.9: <code>InstanceAuditHeaderMapping</code> no longer separates the type GUID and supertype
                        GUIDs, but places all such information into a single vector (for improved search performance);
                        <code>RelationshipMapping</code> no longer has separate properties for each entity proxy, but
                        stores them as a vector: this retains their ordering, but allows relationships to be more
                        efficiently searched from either related entity</li>
                </ul>
            </section>
        </section>

    </div>
</div>

<script src="../reveal.js/dist/reveal.js"></script>
<script src="../reveal.js/plugin/notes/notes.js"></script>
<script src="../reveal.js/plugin/markdown/markdown.js"></script>
<script src="../reveal.js/plugin/highlight/highlight.js"></script>
<script src="../reveal.js/plugin/menu/menu.js"></script>
<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
				center: false,
				slideNumber: true,
				transition: 'slide',
				backgroundTransition: 'fade',
				controls: true,
				controlsTutorial: true,
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealMenu ],
				menu: {
					side: 'left',
					width: 'normal',
					numbers: false,
					titleSelector: 'h1, h2, h3',
					useTextContentForMissingTitles: false,
					hideMissingTitles: true,
					markers: true,
					themes: false,
					themesPath: 'dist/theme/',
					transitions: false,
					openButton: true,
					openSlideNumber: true,
					keyboard: true,
					sticky: false,
					autoOpen: true,
					delayInit: false,
					openOnInit: false,
					loadIcons: true
				}
			});
		</script>
</body>
</html>
